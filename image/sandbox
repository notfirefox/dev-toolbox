#!/bin/sh

if [ -z "$SANDBOX" ]; then
    SANDBOX="$(date +%T)"
    export SANDBOX

    . "/run/.containerenv"
    CONTAINER_DIR="$HOME/Toolbox/$name"
    mkdir --parents "$CONTAINER_DIR"

<<<<<<< HEAD
    bwrap \
        --ro-bind /bin /bin \
        --ro-bind /etc /etc \
        --ro-bind /lib /lib \
        --ro-bind /lib64 /lib64 \
        --ro-bind /opt /opt \
        --ro-bind /sbin /sbin \
        --ro-bind /usr /usr \
        --ro-bind /sys /sys \
        --ro-bind "/run/.containerenv" "/run/.containerenv" \
        --ro-bind "/run/.toolboxenv" "/run/.toolboxenv" \
        --ro-bind "/run/systemd/resolve" "/run/systemd/resolve" \
        --bind "$XDG_RUNTIME_DIR" "$XDG_RUNTIME_DIR" \
        --bind "$CONTAINER_DIR" "$HOME" \
        --chdir "$HOME" \
        --dev /dev \
        --proc /proc \
        --tmpfs /tmp \
        --dev-bind /dev/dri /dev/dri \
        /usr/bin/bash
fi
=======
. "/run/.containerenv"
CONTAINER_DIR="$HOME/Toolbox/$name"
mkdir --parents "$CONTAINER_DIR"

bwrap \
    --ro-bind /bin /bin \
    --ro-bind /etc /etc \
    --ro-bind /lib /lib \
    --ro-bind /lib64 /lib64 \
    --ro-bind /opt /opt \
    --ro-bind /sbin /sbin \
    --ro-bind /usr /usr \
    --ro-bind /sys /sys \
    --ro-bind "$WAYLAND" "$WAYLAND" \
    --ro-bind "/run/.containerenv" "/run/.containerenv" \
    --ro-bind "/run/.toolboxenv" "/run/.toolboxenv" \
    --ro-bind "/run/systemd/resolve" "/run/systemd/resolve" \
    --bind "$DBUS_PROXY/secret-service.sock" "$XDG_RUNTIME_DIR/bus" \
    --bind "$CONTAINER_DIR" "$HOME" \
    --chdir "$HOME" \
    --dev /dev \
    --proc /proc \
    --tmpfs /tmp \
    --dev-bind /dev/dri /dev/dri \
    /usr/bin/bash
>>>>>>> 458b994 (Add ro-binding for `/opt`)
